\section{Постановка задачи}

В этой главе подробно описаны основные требования к системе, разрабатываемой в~рамках данной работы,
а так~же в~контексте конкретных задач рассмотрены основные понятия предметной области. 

Для дальнейшего ознакомления с работой необходимо ознакомиться с некоторыми базовыми терминами предметной области.

\textbf{IPTV} --- технология, позволяющая передавать телевизионное изображение и звук по компьютерным сетям с использованием протокола IP.

\textbf{IPTV-провайдер} \textit{(синонимы: провайдер)} ---
 организация, предоставляющая абонентам услугу цифрового телевидения с использованием IPTV.

\textbf{Live} \textit{(синонимы: TV, телевещание)} --- часть деятельности провайдера, связанная с вещанием
телеканалов в режиме реального времени.

\textbf{VOD} \textit{(синонимы: Video-on-Demand, статика)} --- часть деятельности провайдера, связанная 
с предоставлением доступа к статичному видео-контенту.

В системе \textbf{Live} и \textbf{VOD} должны быть представлены в виде двух различных разделов приложения,
так как процессы, протекающие в контексте этих частей, практически не пересекаются.

\label{gloss:asset}
\textbf{Ассет} \textit{(синонимы: Asset, клип)} --- единица статичного контента, множество которых составляет
VOD-библиотеку провайдера.

\textbf{Правообладатель} \textit{(синонимы: Лицензиар)} --- организация, предоставляющая контент провайдеру.

\textbf{Биллинг провайдера} --- система, в которой происходит учет информации об использовании абонентами услуг провайдера, их тарификация, 
выставление счетов абонентам, обработка платежей. Для проектируемой в рамках данной работы системы биллинг является основным источником
данных, используемых при построении отчетов.

\textbf{База абонентов} \textit{(синонимы: база, base)} --- в разных случаях так называют число или множество абонентов,
удовлетворяющих определенному критерию. Например число абонентов определенного пакета телеканалов.

\textbf{Заказ VOD} \textit{(синонимы: заказ)} --- сущность, связанная с уникальным доступом абонента к одному из
ассетов VOD-библиотеки провайдера. Причем в различных случаях заказы могут быть либо платными, либо бесплатными. 

\textbf{Lighthouse Management} \textit{(синонимы: LM)} --- програмное решение для управления контентом IPTV-провайдера.

\subsection{Импорт данных}
Бизнес-процессы, исполняемые IPTV-провайдеров, порождают большое количество разнородных данных, 
на~основе которых должны строиться статистические отчеты.

В соответствии с числом базовых бизнес-процессов, описанных во Введении, существует два
основных вида данных, для которых нужно реализовать механизм импорта:

\begin{enumerate}
\item{
Структура договоров с правообладателями, которая детально описывает размер 
отчислений правообладателям при разных параметрах.
}
\item{
Данные, связанные с предоставлениям услуг абонентам: размер выручки провайдера, количество подписчиков и заказов VOD. 
}
\end{enumerate}

В этом разделе детально описаны источники данных, структура этих данных и понятия предметной области,
связанные с ними.

\subsubsection{Справочники}
Справочники --- это сущности, непосредственно связанные с деятельностью провайдера, однако не играющие ключевой роли
в~оценке состояния бизнес-процессов. Предполагается, что данные из~справочников не подвержены регулярным изменениям,
и их наполнение нужно произвести лишь однажды при инициализации системы.

Ниже описаны основные типы справочников:
\paragraph{Организации}
Список юридических лиц с их основными реквизитами. 

\paragraph{Дерево Территорий}
\label{par:regions}
Большая часть сущностей, используемых при построении отчетов, имеет связь с~конкретными территориями,
в которых провайдер осуществляет свою деятельность. Множество территорий образует дерево 
с четырьмя уровнями, причём в каждый уровень включаются объекты, непосредственно подчинённые объектам предыдущего уровня:

\begin{itemize}
\item{
  \textit{Страна} --- на данный момент деятельность провайдера ведется только в РФ, но при проектировании
  стоит учитывать возможность выхода на рынки других стран.
}
\item{
  \textit{Регион} --- страны разделяются на множество регионов. В случае РФ регионы соотвествуют
  крупным единицам административно-территориального деления, таким как Сибирский Федеральный округ 
  или Южный федеральный округ.
}
\item{
  \textit{Филиал} --- территориальная единица областного или краевого масштаба, характеризуется наличием
  местного филиала провайдера.
}
\item{
  \textit{Город} --- лист дерева регионов, соответствует населенным пунктам, в которых ведется деятельность провайдера.
}
\end{itemize}

Далее в работе термин ``Регион'' будет использоваться, как синоним понятия ``Территория''.

\paragraph{Телеканалы}
Список телеканалов, вещание которых производится провайдером. Каждый из каналов характеризуется его именем
и уникальным идентификатором в биллинге провайдера.

\paragraph{Пакеты телеканалов}
Каждый абонент IPTV-провайдера при подключении выбирает один из пакетов телеканалов, на~который
он подписывается. В контексте справочников пакеты характеризуются их именем и уникальным идентификатором
в~биллинге провайдера.

\subsubsection{Договоры с правообладателями}
\label{task:contracts}

Договоры с правообладателями --- это сущности, описывающие условия предоставления контента провайдеру.
В целом структуры договоров по Live и VOD похожи, но каждый из этих видов обладает своей спецификой.

\paragraph{Договоры по Live}
Основные характеристики договоров этого типа:

\begin{itemize}
\item{
  \textit{Правообладатель} - организация, с которой заключен договор.
}
\item{
  \textit{Юр. лицо} -  организация со стороны провайдера, на имя которой заключен договор.
}
\item{
  \textit{Номер договора} ---  уникальный идентификатор со сквозной нумерацией.
}
\item{
  \textit{Даты} --- дата заключения договора и его длительность.
}
\item{
  \textit{Территории} --- множество вершин дерева территорий, для которого актуален договор.
}
\end{itemize}

Каждый из договоров по Live содержит в себе \textit{пакеты телеканалов} (один и более), права на вещание которых обеспечивает договор.

Для каждого из пакетов должны быть описаны градации отчислений (не менее одной в пакете), устанавливающие условия и размер
отчислений правообладателю. Структура градаций подробнее рассмотрена в разделе \ref{live:deducts}.

На момент проектирования системы договоры по Live у провайдера хранились в виде файла формата Microsoft Excel 2007, в~связи с~чем
необходимо было реализовать модуль для регулярного импорта договоров со всеми связанными с ними сущностями из этого файла.

\paragraph{Договоры по VOD} в целом изоморфны договорам первого типа, за исключением того, что условия договоров распространяются на множества ``ассетов''
вместо пакетов телеканалов.

\subsubsection{Статистические данные по Live}
\label{stat:live}
Существует несколько видов статистических данных, связанных с Live, которые система должна регулярно импортировать
с помощью веб-сервисов биллинга.

\textbf{Количество подписчиков пакетов} --- множество кортежей, каждый из которых содержит информацию о количестве подписчиков
определенного пакета телеканалов для конкретной даты в одном из листьев дерева регионов (см. \ref{par:regions}).

\textbf{Доступность телеканала} --- множество кортежей, каждый из которых содержит информацию о доступности телеканала в
определенном пакете для конкретной даты в одном из листьев дерева регионов.

\label{stat:subscribers}
Информация о количестве подписчиков определенного телеканала в пакете не может быть получена из биллинга по той причине, что этой информации там нет, 
так как при подключении абоненты выбирают именно пакеты каналов. Но при этом можно вычислить усредненное значение этой величины 
в~рамках определенной даты, территории, пакета и телеканала по формуле:
$$Subscribers_{channel} = \frac{Subsribers_{packet}} {Channels_{packet}}, $$
где $Subscribers_{channel}$ --- искомая величина,  $Subsribers_{packet}$ --- количество подписчиков пакета, 
а $Channels_{packet}$ --- количество доступных в пакете каналов.

Еще одной важной импортируемой из биллинга величиной является \textbf{Выручка} --- множество кортежей, каждый из которых содержит информацию о
суммарной абонетской плате, полученной по определенному пакету телеканалов для конкретной даты в одном из листьев дерева регионов.
 
Веб-сервисы биллинга предоставляют вышеописанные данные в формате XML со строго заданной схемой. Система должна ежедневно импортировать эти данные,
сохраняя записи за последние пять лет.

\textbf{IPTV база за 30 дней} \textit{(синонимы: IPTV base 30d, IPTV base)} --- множество кортежей, каждый из которых содержит дату,
регион и количество активных IPTV абонентов за последние 30 дней от даты в регионе. 
Данные должны импортироваться из файла формата Excel c фиксированным форматом.
\textit{Не следует путать эту величину с ``Количеством подписчиков'',  IPTV база представляет собой некоторое усреднненое число 
абонентов IPTV и VOD и используется только при генерации отчетов для VOD.}

\subsubsection{Статистические данные по VOD}
\label{stat:vod}
Множество доступных абонентам \textit{Ассетов}(см. \ref{gloss:asset}) должно еженедельно импортироваться в систему из 
биллинга провайдера, для этого также предоставляется веб-сервис, возвращающий данные в формате XML.

Основным видом статистических данных для VOD являются \textit{Заказы абонентов}, каждый из которых связан с одним из ассетов,
а также содержит информацию о дате, когда был сделан заказ, регионе абонента, и стоимости, которая списана со счета абонента.
Также в заказе задан уникальный идентификатор абонента.

Импорт заказов также должен производится из биллинга ежедневно.

\subsection{CRUD-интерфейс} 
\label{section:crud}
Для каждого типа сущностей, введенного в рамках системы необходимо разработать удобный интерфейс для добавления, 
просмотра, редактирования, удаления и поиска записей.

\subsubsection{Список объектов}
\label{crud:list}
Должен быть реализован постраничный вывод каждого из множеств сущностей с возможностью фильтрации и сортировки
по значениям полей, кроме того необходим механизм удаления одновременно нескольких объектов из списка.
Для каждой сущности на странице должны быть выведены основные поля, характеризующие объект.
Если характеристикой объекта является связь с другими сущностями в формате ``многие к одному'',
нужно вывести наименование связанного объекта, а в форме фильтрации обеспечить возможность выбора объекта
для фильтрации. 

В случае хронологического характера данных по умолчанию сортировка должна производиться по дате в убывающем порядке.

\subsubsection{Формы создания и редактирования}
\label{crud:forms}
Создание и редактирование объектов должно происходить на отдельной странице с выведенной на ней формой для ввода данных.
Следует уделить особое внимание верификации и контролю целостности данных при сохранении форм, а в случае неверно
введенных данных уведомлять пользователя об ошибке, выделяя те поля формы, где произошла ошибка.

Существуют следующие основны типы ``проверки корректности данных'':
\begin{itemize}
\item{
  \textit{Обязательное значение} --- поле обязательно должно быть заполнено. Например номер договора. 
}
\item{
  \textit{Формат} --- значение поля должно удовлетворять определенному формату (число, дата и т.п.).
}
\item{
  \textit{Уникальность} --- значение поля или совокупность значений полей должна быть уникальна в рамках
данного типа сущности.
}
\item{
  \textit{Частные случаи проверки корректности данных} --- для некоторых сущностей существуют особые правила заполнения полей,
  когда то или иное значение считается корректным в зависимости от значений других полей. 
  Например в градациях договоров по Live не могут быть одновременно заполнены поля ``Фиксированный платеж`` 
  и ``Платеж за абонента'', но при этом одно из полей должно быть непустым.
}
\end{itemize}

Для договоров с правообладателями необходимо выводить связанные с ними условия(градации и пакеты)
в виде табличной detail-формы внутри которой также должна быть возможность фильтрации и сортировки по выбранным полям.

\subsection{Алгоритм расчета отчислений правообладателям}
\label{live:deducts}
\textbf{Отчисления правообладателям} --- это сумма, которую провайдер ежемесячно выплачивает лицензиарам
в соответствии с условиями договоров. В рамках проектируемой системы необходимо реализовать алгоритм расчета
этой величины, а также создать интерфейс для вычисления отчислений за произвольный месяц на основе текущей 
структуры договоров. Полученные значения должны сохраняться в базе данных и выводиться пользователю 
в виде списка объектов (см \ref{crud:list}).

Так как для первой версии системы предусмотрена автоматическая генерация отчислений 
только для Live, далее в этом разделе будет описан алгоритм только для этого типа договоров.

Сумма для для конкретного правообладателя расчитывается следующим образом:

$$Deducts_{licensor} = \sum_{contract \in Contracts} Deducts(contract)$$,

то есть как сумма отчислений по активным договорам этого лицензиара. 

Отчисления по отдельному договору вычисляется как сумма отчислений по каждой из его применимых по сроку и базе градаций.

Для определения применимости градации по сроку задана характеристика ``Срок действия градации'', состоящая из двух дат.
Если этот параметр заполнен, то градация применима только в том случае, если период, 
для которого расчитываются отчисления пересекается со сроком действия градации. 

Применимость по базе определяется в зависимости от вида расчета, но общая суть заключается в том, 
что количество абонентов градации должно лежать в интервале характеристик градации ``Мин. число абонентов'' и
``Макс. число абонентов'', в случае если они заданы.  

\subsubsection{Виды расчета отчислений}
Характеристика градации ``Вид расчета'' определяет каким образом будет вычислена сумма для каждой градации,
каждый из видов описан далее. По сути разница состоит в том, будет ли сумма считаться отдельно
для каждого телеканала пакета, или для всей совокупности одновременно.

\paragraph{Раздельный вид расчета}
В случае раздельного вида расчета для каждого телеканала из пакета, которому принадлежит градация,
расчет производится отдельно, затем полученные величины суммируются:

$$Deducts_{gradation} = \sum_{channel \in Channels_{packet}} deductbase(gradation, Subscribers_{channel})$$

Методы вычисления величины $Subscribers_{channel}$ (база канала) описаны в \ref{stat:subscribers}.
Вид функции $deductbase$(отчисления по базе абонентов) будет описана ниже. 

Градация считается применимой по базе в случае, если хотя бы база одного из каналов принадлежит отрезку 
[`Мин. число абонентов'', ``Макс. число абонентов''].

В случае суммарного вида расчета существует возможность получить корректную сумму отчислений по каждому из 
телеканалов.

\paragraph{Суммарный вид расчета}
Для суммарного вида расчета вычисляется величина:
$$Subscribers_{gradation} = \max\limits_{channel \in Channels_{packet}} Subscribers_{channel}$$

Сумма отчислений по градации устанавливается как:
$$Deducts_{gradation} = deductbase(gradation, Subscribers_{gradation})$$

Градация считается применимой по базе в случае, если величина $Subscribers_{gradation}$ принадлежит отрезку 
[`Мин. число абонентов'', ``Макс. число абонентов''].

Для этого вида расчета нельзя точно установить точную сумму отчислений по каждому телеканалу в отдельности,
однако в рамках разрабатываемой системы для использования в отчетах можно вычислять усредненную величину как частное 
суммы отчислений и числа каналов в пакете.

\subsubsection{Схемы расчета отчислений}
Сумма отчисления по градации и базе абонентов ($deductbase$) расчитывается в зависимости от 
``Cхемы расчета'' --- еще одной характеристики градации. Существует две схемы расчета ``Платеж за абонента''
и ``Фиксированный платеж''. При валюте договора отличной от рублей необходимо перевести все денежные величины
в рублевый эквивалент по актуальному на период расчета курсу (последний день месяца).

В случае схемы ``Фиксированный платеж'' отчисления по базе не зависят от этой величины, и равны величине ``Фикс.платеж'' т.е. 
$ deductbase(gradation, subscribers) = Fix_{gradation} $.

Расчет по схеме ``Платеж за абонента'' должен происходить по следующей формуле:
$$ deductbase(G, C) =  \max(C, GR_{G}) \times AP_{G} \times \lfloor \frac{CalcDays}{PeriodDays} \rfloor \times \frac{DeductPercent_{G}}{100}$$

В этой формуле $G$ --- градация, по которой устанавливается сумма, $C$ - количество подписчиков за расчетный период,
$GR_{G}$ --- характеристика градации ``Минимальное гарантированное число абонентов'',
$AP_{G}$ --- характеристика градации ``Платеж за абонента'',
$CalcDays$ --- число дней расчетного периода, в которые данная градация была актуальна,
$PeriodDays$ --- число дней в расчетном периоде,
$DeductPercent_{G}$ --- характеристика градации ``Процент отчислений''.

\subsection{Генерация статистических отчетов}
\label{section:stat_reports_task}
Генерация статистических отчетов является ключевой задачей в рамках данной работы. При их построении должны использоваться
данные, формат которых описан в \ref{stat:live} и \ref{stat:vod}, а также полученные в \ref{live:deducts}
данные по отчислениям. 
Структуру получаемых отчетов следует рассматривать как дерево, каждая вершина которого определяет уровень детализации
или фильтрации данных для вычисляемых показателей.

\begin{figure}[!ht]
\begin{center}
\hspace*{-1cm} \includegraphics[scale=0.6, trim=0mm 50mm 70mm 0mm, clip]{../resources/uml/ReportScheme.pdf}
\caption{Cхематичная структура отчета}
\label{gr:report:scheme}
\end{center}
\end{figure} 

На схеме (Рис. \ref{gr:report:scheme}) в виде прямоугольников изображены вершины дерева отчетов,
которые не содержат непосредственно значений вычисляемых показателей, а в виде овалов узлы,
для которых эти значения вычислены. Как видно из схемы, отчет может быть построен с детализацией 
по вершинам дерева регионов, кроме того каждый конкретный показатель может быть детализирован
в соответствии с требованиями пользователя.

Отчет должен генерироваться за определенный период, выбранный пользователем, причем он может быть 
разбит на подинтервалы, для каждого из которых должны быть вычислены значения показателей.
Таким образом каждая вершина дерева отчета со значениями должна содержать в себе список 
значений показателя для каждого из подинтервалов.

В общем виде сценарий генерации отчетов для пользователя должет выглядеть следующим образом:
\begin{enumerate}
\item{
  Пользователь открывает страницу с формой генерации отчета. Предполагается две различные страницы
  для отчетов по Live и VOD.
}
\item{
  Пользователь устанавливает параметры отчета на форме и запускает генерацию отчета.
}
\item{
  После того, как процесс генерации отчета завершился, он становится доступен пользователю для просмотра
  или скачивания.
}
\end{enumerate} 

Стоит уточнить, что в рамках настоящей работы условлено, что сгенерированный отчет должен быть доступен 
для пользователя в виде файла формата Excel, в котором построчно выведено дерево отчетов, а значения показателей
для каждого из подинтервалов периода записано в отдельную колонку.

\subsubsection{Форма параметров отчета}
В этом разделе перечислены основные параметры для построения отчета, в том числе специфичные для отчетов
по Live и VOD. Все значения параметров должны сохраняться для каждого пользователя таким образом,
чтобы при возобновлении работы с формой восстанавливались значения последней сессии.

\paragraph{Период отчета} Интервал дат, на основе которого выбирается период, за который строится отчет.
Должна быть возможность задать один из периодов по умолчанию: ``За последнюю неделю'', ``За последний месяц'',
``За последний год''.

\paragraph{Периодичность данных} Параметр, определяющий способ разбиения выбранного периода на подинтервалы.
Возможные значения: ``По дням'', ``По неделям'', ``По месяцам'', ``По кварталам'', ``По годам''.

\paragraph{Валюта} Параметр задает, в каких валютах выводить данные. 
Если параметр не установлен, идет пересчет всех сумм в рубли. 
Если параметр установлен, в отчете в разделе ``Отчисления'' появляются дополнительные строки: ``в т.ч. в долларах'', 
``в т.ч. в евро''. Одновременно могут быть выбраны несколько значений.

\paragraph{Детализация по территориям} Параметр, определяющий структуру дерева регионов, на основе
которой будет построен отчет

Возможные значения детализации по территориям:
\begin{itemize}
\item{
Регионы, Филиалы, Города
}
\item{
Регионы, филиалы
}
\item{
Филиалы
}
\item{
Регионы
}
\item{
Города
}
\end{itemize}

Также этот параметр определяет диалог выбора значений для параметра ``Фильтр по территориям''.

\paragraph{Фильтр по территориям} Определяет, по каким территориям будут показаны данные в отчете. 
Позволяет пользователю выбрать произвольное число регионов.

\paragraph{Правообладатели} Параметр задает фильтр по правообладателям. 
Диалог выбора представляет собой список правообладателей по всем договорам за период отчета, отсортированный в алфавитном порядке.

\paragraph{Показатели} Параметр позволяет пользователю выбрать один или более показателей, для которых будут вычисляться значения.

\paragraph{Детализация по пакетам и телеканалам} \textit{(только для Live)}
Параметр задающий уровни детализации показателей. Возможные значения:
``Без детализации'', ``По пакетам'', ``По телеканалам'', ``По пакетам, затем по телеканалам'',
``По телеканалам, затем по пакетам''.

\paragraph{Фильтр пакетов и телеканалов} \textit{(только для Live)} Параметры, определяющие для каких именно пакетов
и телеканалов вычисляются значения показателей.

\subsubsection{Описание показателей}
\label{reports:indicators}
Каждый из описанных ниже показателей должен быть доступен для выбора пользователю при генерации
отчета по Live или VOD, кроме того для каждого из них зафиксирован максимальный уровень детализации,
для которого он может быть расчитан. Следует также отметить, что многие из показателей вычисляются
на основе других показателей.

\paragraph{Live}
\begin{itemize}
\item{
\textit{Количество абонентов на начало периода}. Вычисляется на основе данных, формат которых описан в \ref{stat:live}.
 Максимальная детализация в отчете: территория, пакет, телеканал, дата.
}
\item{
\textit{Количество абонентов на конец периода}. Вычисляется на основе данных, формат которых описан в \ref{stat:live}.
Максимальная детализация в отчете: территория, пакет, телеканал, дата.
}
\item{
\textit{Среднее количество абонентов за период}.  Вычисляется как среднее арифметическое количества абонентов на начало 
и конец периода. Максимальная детализация в отчете: территория, пакет, телеканал, дата.
}
\item{
\textit{Выручка}. Вычисляется на основе данных, формат которых описан в \ref{stat:live}.
Максимальная детализация в отчете – территория, пакет, дата (по телеканалам не считается).
}
\item{
\textit{Отчисления}. Вычисляется на основе данных, формат которых описан в \ref{live:deducts}.
Максимальная детализация в отчете: территория, пакет, телеканал, дата.
}
\item{
\textit{Прибыль} = выручка – отчисления. Максимальная детализация в отчете: территория, пакет, дата (по телеканалам не считается). 
}
\item{
\textit{Маржинальность} = прибыль/выручка*100\%. Максимальная детализация в отчете: территория, пакет, дата (по телеканалам не считается).
}
\item{
\textit{ARPU} = выручка/среднее количество пользователей за период. Максимальная детализация в отчете: территория, пакет, дата (по телеканалам не считается).
}
\end{itemize}

\paragraph{VOD}
\begin{itemize}
\item{
\textit{IPTV Active 30d EOP}. Вычисляется как $\frac{IPTVbase_{end} - IPTVbase_{begin}}{IPTVbase_{begin}} \times 100 \% $, 
где $IPTVbase_{begin}$ и $IPTVbase_{end}$ --- значение IPTV базы за 30 дней на начало и конец периода (см. \ref{stat:live}).
}
\item{
\textit{VOD выручка (без НДС)}. Вычисляется на основе данных, формат которых описан в \ref{stat:vod}, как сумма оплаченных
заказов по VOD.
}
\item{
\textit{VOD выручка (c НДС)}. Вычисляется на основе данных, формат которых описан в \ref{stat:vod}.
}
\item{
\textit{Отчисления}. Cумма отчислений по VOD за период.
}
\item{
\textit{Отчисления по фиксированному платежу (без НДС)}. Уплаченная сумма отчислений по фиксированному платежу за период.
}
\item{
\textit{Отчисления по минимальной гарантии (без НДС)}. Уплаченная сумма отчислений по минимальной гарантии за период.
}
\item{
\textit{Отчисления по разделению дохода (без НДС)}. Уплаченная сумма отчислений по разделению дохода за период.
}
\item{
\textit{Прибыль (без НДС)}. Вычисляется как ``(Выручка по VOD / 1.18) – Отчисления''.
}
\item{
\textit{Маржинальность (без НДС)}. Вычисляется как ``Прибыль по VOD без НДС / выручка по VOD без НДС * 100%``
}
\item{
\textit{Количество заказов}. Сущетсвует три показателя этого типа в зависимости от типа заказов: платный / бесплатный / любой.
}
\item{
\textit{Среднее количество покупок на IPTV пользователя}. Вычисляется как
Количество платных заказов по VOD / Active IPTV Base 30d, причем Active IPTV Users 30d берется на конечную дату периода.
}
\item{
\textit{Количество пользователей}. Вычисляется с помощью подсчета уникальных идентификаторов пользователей из заказов VOD
(см. \ref{stat:vod}). Также как и для Количества заказов существует три показателя этого типа.
}
\item{
\textit{Проникновение пользователей в IPTV}. Вычисляется как 
``Кол-во VOD-пользователей/ Active IPTV 30d Base * 100\%''. Также как и для Количества пользователей существует три показателя этого типа. 
}
\item{
\textit{Средне количество заказов}. Вычисляется как
``Количество заказов VOD /  количество абонентов''. Также как и для Количества пользователей существует три показателя этого типа.
}
\item{
\textit{Средняя стоимость платных заказов VOD (без НДС)}. Вычисляется как 
``(Выручка по VOD / 1.18) / Количество платных заказов за период''.
}
\item{
\textit{ARPU (без НДС) на VOD пользователей}. Вычисляется как ``выручка без НДС / количество уникальных пользователей VOD''
}
\item{
\textit{ARPU (без НДС) на VOD пользователей сделавших платный заказ}. 
Вычисляется как ``выручка без НДС / количество уникальных пользователей VOD, сделавших платный заказ''.
}
\item{
\textit{ARPU (без НДС) на IPTV-пользователей}. Вычисляется как ``выручка без НДС / Active IPTV Base 30d''.
}
\item{
\textit{Количество фильмов, план}.
Количество фильмов, у которых есть ассеты за заданный период.
Проверка “входит ли ассет в заданный период” делается на основе полей “Дата начала”, “Дата окончания” у ассета.
(см. \ref{stat:vod})
}
\item{
\textit{Количество фильмов, факт}.
Количество фильмов, у которых есть ассеты за заданный период.
Проверка “входит ли ассет в заданный период” делается на основе того, есть ли хотя бы 1 заказ на ассет за заданный период.
}
\end{itemize}

\subsection{Авторизация и разграничение прав доступа}
В разрабатываемой системе должны должны быть реализованы механизмы аутентификации и авторизации пользователей
с возможностью разграничения прав доступа к различным модулям системы.

Должны быть предусмотрены следующие сценарии:
\begin{enumerate}
\item{
Просмотр списка пользователей в соответствии с пунктом \ref{crud:list}.
}
\item{
Создание, изменение, удаление пользователей, активация новых пользователей в соответствии с \ref{crud:forms}.
}
\item{
Редактирование собственного профиля пользователя (редактирование логина, пароля, e-mail, имени, фамилии).
}
\item{
Аутентификация, выход из системы.
}
\end{enumerate}

Администратором системы для каждого пользователя может быть выбрано подмножество прав доступа из следующего списка:
\begin{itemize}
\item{
Live. Чтение
}
\item{
Live. Запись
}
\item{
Live. Доступ к коммерческим условиям
}
\item{
Vod. Чтение
}
\item{
Vod. Запись
}
\item{
Vod. Доступ к коммерческим условиям
}
\item{
Системные настройки. Чтение
}
\item{
Системные настройки. Запись
}
\item{
Системные настройки / Пользователи. Чтение
}
\item{
Системные настройки / Пользователи. Запись
}
\end{itemize}

Права на чтение и запись дают доступ на чтение и запись (добавление, изменение удаление записей) для всех форм в соответствующем разделе.

Раздел ``Системные настройки'' содержит страницы справочников, общих для разделов Live и Vod, а также интерфейс для
импорта данных и запуска расчета отчислений по IPTV.

Права на доступ к коммерческим условиям разрешают или запрещают доступ к страницам, на которых упоминаются денежные суммы 
или условия лицензий или договоров. Для таких страниц для чтения должны быть установлены одновременно права на чтение и 
права на доступ к коммерческим условиям, для записи - одновременно установлены право на запись и права на доступ к 
коммерческим условиям. \textit{Исключение: для отчетов, если у пользователя не установлены права доступа к коммерческим условиям, 
но есть право на чтение, то пользователю доступны только параметры отчета и данные отчета, не содержащие коммерческих условий.}

\subsection{Формулировка задачи}
В рамках настоящей работы были поставлены следующие задачи:

\begin{enumerate}
\item{
  Реализация модуля импорта данных.
}
\item{
  Реализация подсистемы, обеспечивающей удобный интерфейс для~поиска, просмотра и модификации импортированных данных.
}
\item{
  Реализация алгоритма расчета отчислений правообладателям. 
}
\item{
  Генерация статистических отчетов в соответствии с~пожеланиями пользователя.
}
\item{
  Реализация механизмов авторизации, позволяющих разграничивать права доступа пользователей к~различным частям системы.
}
\end{enumerate}

Кроме того со стороны заказчика были выдвинуты следующие нефункциональные требования к~системе:
\label{part:requirements}
\begin{enumerate}
\item{
  Система должна быть реализована в~виде веб-приложения.
}
\item{
  В~качестве хранилища данных должна быть использована СУБД Microsoft SQL Server.
}
\item{
  Должен быть продуман механизм первоначальной установки системы и обновления версий 
  с~учетом ограничения доступа со стороны исполнителей к~веб-серверу и серверу~БД.
}
\end{enumerate}
